<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENÚ CAPIBOBBA - WhatsApp Optimized</title>
    
    <!-- Enlace al archivo CSS externo -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Google Fonts: Preconnect para mejorar la velocidad de descarga -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Google Fonts: Precarga y estilos para Nunito y Balsamiq Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Balsamiq+Sans:wght@700&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
</head>
<body>
    <!-- Burbujas de fondo animadas (elementos puramente decorativos) -->
    <div class="bubbles-background" aria-hidden="true">
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
    </div>

    <!-- Contenedor principal de decoraciones kawaii flotantes (puramente decorativas) -->
    <div class="kawaii-decorations-wrapper" aria-hidden="true">
        <span class="kawaii-decoration bubble-tea-cup">🧋</span>
        <span class="kawaii-decoration capybara-float-1">🦫</span>
        <span class="kawaii-decoration capybara-float-2">🦫</span>
        <span class="kawaii-decoration heart-float">💖</span>
    </div>
    
    <!-- Contenedor principal de todo el contenido del menú -->
    <main class="menu-container">
        <!-- Encabezado principal de la página -->
        <header class="header">
            <div class="capybobba-mascot" role="img" aria-label="Capibobba Logo con un corazón flotante">
                <!-- Imágenes del logo con atributos de rendimiento y accesibilidad -->
                <img id="logoLight" src="https://i.imgur.com/llR0NN0.png" alt="Capibobba Logo Modo Claro" width="250" height="250" loading="eager">
                <img id="logoDark" src="https://i.imgur.com/i7psA3z.png" alt="Capibobba Logo Modo Oscuro" width="250" height="250" loading="eager">
            </div>
            <h1 class="main-title">MENÚ CAPIBOBBA</h1>
            <p class="tagline">¡Dale un abrazo a tu bebida favorita! 🧸💕</p>

            <!-- Resumen del carrito flotante en el header -->
            <div class="cart-summary" id="cartSummary" role="status" aria-live="polite" tabindex="0">
                <span class="cart-icon-emoji" id="cartIconEmoji" aria-hidden="true">🛒</span>
                <span class="cart-item-count" id="cartItemCount">0</span>
                <span class="visually-hidden">elementos en el carrito</span>
            </div>

            <!-- Botón de administración de productos -->
            <button id="openAdminPanelButton" class="admin-button" style="display: none;">
                Administrar Productos ⚙️
            </button>
        </header>
        
        <!-- Sección de Bebidas Frías (Frappés de Agua) -->
        <section class="menu-section animate-slide-in-left">
            <h2 class="section-title">💧 Frappés de Agua 💧</h2>
            <div class="flavor-grid" id="waterFrappesGrid">
                <!-- Los productos se cargarán aquí dinámicamente desde Firestore -->
            </div>
        </section>

        <!-- Sección de Bebidas Frías (Frappés de Leche) -->
        <section class="menu-section animate-slide-in-right">
            <h2 class="section-title">🥛 Frappés de Leche 🥛</h2>
            <div class="flavor-grid" id="milkFrappesGrid">
                <!-- Los productos se cargarán aquí dinámicamente desde Firestore -->
            </div>
        </section>

        <!-- Promoción Especial: Chamoyada -->
        <section class="promotion-section animate-on-scroll" id="chamoyadaPromotion" style="display: none;">
            <div class="promotion-content">
                <h2 class="promotion-item-title">🌶️🥭 ¡Nueva! Especialidad: Chamoyada 🥭🌶️</h2>
                <p class="promotion-item-description">Refrescante frappé con un toque picosito de chamoy y el sabor de tu fruta favorita. ¡Personalízala!</p>
                <div class="promotion-actions">
                    <button class="add-drink-to-cart-button" data-name="Chamoyada" data-price="75" aria-label="Añadir Chamoyada al carrito">¡La quiero! 🤤</button>
                </div>
            </div>
        </section>

        <!-- Promoción Especial: Frappé Fresas con Crema (Temporada) -->
        <section class="promotion-section animate-on-scroll" id="fresasConCremaPromotion" style="display: none;">
            <div class="promotion-content">
                <h2 class="promotion-item-title">🍓🥛 Frappé de Temporada: "Fresas con Crema" 🍓🥛</h2>
                <p class="promotion-item-description">La combinación perfecta de fresas frescas y la suavidad de la crema en un delicioso frappé. ¡Solo por tiempo limitado!</p>
                <div class="promotion-actions">
                    <button class="add-drink-to-cart-button" data-name="Frappé Fresas con Crema (Temporada)" data-price="65" aria-label="Añadir Frappé Fresas con Crema al carrito">¡Pruébalo! 😋</button>
                </div>
            </div>
        </section>

        <!-- Sección de Bebidas Calientes -->
        <section class="menu-section animate-slide-in-left">
            <h2 class="section-title">☕ Bebidas Calientes ☕</h2>
            <div class="flavor-grid" id="hotDrinksGrid">
                <!-- Los productos se cargarán aquí dinámicamente desde Firestore -->
            </div>
        </section>

        <!-- Sección del Carrito de Compras -->
        <section class="shopping-cart-section animate-on-scroll" id="shoppingCartSection">
            <h2 class="section-title">Mi Carrito 🛍️</h2>
            <ul id="cartItemsList" class="cart-items-list">
                <!-- Los elementos del carrito se añadirán aquí dinámicamente -->
                <li class="empty-cart-message">¡Tu carrito está vacío, añade algo delicioso! 💖</li>
            </ul>
            <div class="cart-total" id="cartTotal">Total: $0.00</div>
            <div class="cart-actions">
                <button id="clearCartButton" class="clear-cart-button" disabled>Vaciar Carrito 🗑️</button>
                <button id="orderWhatsAppButton" class="order-whatsapp-button" disabled>Pedir por WhatsApp 📱</button>
            </div>
        </section>

        <!-- Contador de Visitantes (visible solo para el desarrollador) -->
        <div id="visitorCounterDisplay" class="visitor-counter-display" style="display: none;">
            <span>Visitantes únicos: <span id="visitorCount">0</span></span>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024 Capibobba. Todos los derechos reservados. Hecho con 💖 y Capibaras.</p>
        </footer>
    </main>

    <!-- Modal para mostrar imagen de sabor -->
    <div id="flavorImageOverlay" class="flavor-image-overlay">
        <div class="flavor-image-modal-content">
            <button class="close-modal-button" aria-label="Cerrar modal de imagen">✖️</button>
            <h3 id="flavorImageName" class="modal-title"></h3>
            <img id="flavorImage" src="" alt="Imagen de sabor" class="flavor-modal-image">
        </div>
    </div>

    <!-- Modal para selección de toppings -->
    <div id="toppingSelectionOverlay" class="topping-selection-overlay">
        <div class="topping-selection-modal-content">
            <button class="close-modal-button" aria-label="Cerrar modal de toppings">✖️</button>
            <h3 class="modal-title">Personaliza tu <span id="toppingDrinkName"></span></h3>
            <p class="modal-subtitle">Añade tus toppings favoritos:</p>
            <div id="toppingsModalGrid" class="toppings-modal-grid">
                <!-- Toppings se cargarán aquí dinámicamente -->
            </div>
            <div class="modal-actions">
                <button id="confirmToppingsButton" class="confirm-button">Confirmar Selección ✅</button>
                <button id="noToppingsButton" class="no-toppings-button">Sin Toppings 🚫</button>
                <button id="cancelToppingsButton" class="cancel-button">Cancelar ❌</button>
            </div>
        </div>
    </div>

    <!-- Modal para personalización de Chamoyada -->
    <div id="chamoyadaCustomizationOverlay" class="chamoyada-customization-overlay">
        <div class="chamoyada-customization-modal-content">
            <button class="close-modal-button" aria-label="Cerrar modal de Chamoyada">✖️</button>
            <h3 class="modal-title">Personaliza tu Chamoyada 🥭🌶️</h3>
            <p class="modal-subtitle">1. Elige tu sabor base:</p>
            <div id="chamoyadaBaseFlavorGrid" class="chamoyada-base-flavor-grid">
                <!-- Sabores base se cargarán aquí dinámicamente -->
            </div>
            <p class="modal-subtitle">2. Añade toppings (opcional):</p>
            <div id="chamoyadaToppingsGrid" class="toppings-modal-grid">
                <!-- Toppings se cargarán aquí dinámicamente -->
            </div>
            <div class="modal-actions">
                <button id="confirmChamoyadaButton" class="confirm-button">Añadir Chamoyada al Carrito ✅</button>
                <button id="cancelChamoyadaButton" class="cancel-button">Cancelar ❌</button>
            </div>
        </div>
    </div>

    <!-- Modal para el panel de administración de productos -->
    <div id="adminPanelOverlay" class="admin-panel-overlay">
        <div class="admin-panel-content">
            <button class="close-modal-button" aria-label="Cerrar panel de administración">✖️</button>
            <h2 class="modal-title">⚙️ Administración de Productos ⚙️</h2>

            <form id="productForm" class="product-form">
                <input type="hidden" id="productId">
                
                <div class="form-group">
                    <label for="productType">Tipo de Producto:</label>
                    <select id="productType" required>
                        <option value="">Selecciona un tipo</option>
                        <option value="water-based-frappe">Frappé de Agua</option>
                        <option value="milk-based-frappe">Frappé de Leche</option>
                        <option value="hot-drink">Bebida Caliente</option>
                        <option value="promotion">Promoción (Chamoyada/Fresas con Crema)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="productName">Nombre Interno (ej. "Fresa"):</label>
                    <input type="text" id="productName" placeholder="Nombre único del producto" required>
                </div>
                
                <div class="form-group">
                    <label for="productDisplayName">Nombre para Mostrar (ej. "Frappé de Fresa"):</label>
                    <input type="text" id="productDisplayName" placeholder="Nombre visible en el menú" required>
                </div>
                
                <div class="form-group">
                    <label for="productPrice">Precio:</label>
                    <input type="number" id="productPrice" step="0.01" placeholder="Ej. 65.00" required>
                </div>
                
                <div class="form-group">
                    <label for="productDescription">Descripción:</label>
                    <textarea id="productDescription" placeholder="Breve descripción del producto" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="productImageUrl">URL de Imagen:</label>
                    <input type="url" id="productImageUrl" placeholder="URL de la imagen del producto">
                </div>
                
                <div class="form-actions">
                    <button type="submit" id="saveProductButton" class="confirm-button">Guardar Producto ✨</button>
                    <button type="button" id="cancelEditButton" class="cancel-button">Limpiar Formulario 🔄</button>
                </div>
            </form>

            <h3 class="admin-list-title">Productos Actuales</h3>
            <ul id="adminProductsList" class="admin-products-list">
                <!-- Los productos se listarán aquí para edición/eliminación -->
            </ul>
        </div>
    </div>

    <!-- Enlace al archivo JavaScript externo (siempre al final del body) -->
    <script type="module" src="script.js"></script>
</body>
</html>
