<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEN√ö CAPIBOBBA - WhatsApp Optimized</title>
    <style>
        /* Importa la fuente Nunito de Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');
        
        /* Reseteo b√°sico de CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Estilos generales del cuerpo de la p√°gina */
        body {
            font-family: 'Nunito', sans-serif;
            width: 100%; /* Ensures it occupies the full available width */
            max-width: 1080px; /* Maximum width for the main content */
            height: auto;
            margin: 0 auto; /* Centers the content */
            /* Background gradient for a kawaii touch (Light Mode by default) */
            background: linear-gradient(180deg, #FFE1E6 0%, #F3E8FF 25%, #E0F2FE 50%, #FFF9E6 75%, #FFE1E6 100%);
            position: relative;
            overflow-x: hidden; /* Prevents horizontal scrolling */
            line-height: 1.4;
            transition: background 0.5s ease-in-out; /* Smooth transition for background change */
        }
        
        /* Decorative floating kawaii elements */
        .kawaii-decoration {
            position: absolute;
            z-index: 1;
            opacity: 0.4;
        }
        
        /* Bubble tea cup decoration */
        .bubble-tea-cup {
            width: 80px;
            height: 100px;
            background: linear-gradient(45deg, #FFB6C1, #DDA0DD);
            border-radius: 15px 15px 25px 25px;
            top: 5%;
            right: 8%;
        }
        
        .bubble-tea-cup::before {
            content: 'üßã'; /* Bubble tea emoji */
            position: absolute;
            font-size: 50px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Floating capybaras */
        .capybara-float-1 {
            top: 25%;
            left: 5%;
            font-size: 60px;
            transform: rotate(-15deg);
        }
        
        .capybara-float-2 {
            top: 55%;
            right: 10%;
            font-size: 50px;
            transform: rotate(20deg);
        }
        
        .heart-float {
            top: 75%;
            left: 8%;
            font-size: 40px;
            color: #FF69B4;
        }
        
        /* Main menu container */
        .menu-container {
            position: relative;
            z-index: 2;
            padding: 25px 20px;
            min-height: 100vh;
        }
        
        /* Main content wrapper */
        .content-wrapper {
            background: rgba(255, 255, 255, 0.98); /* Semi-transparent white background (Light Mode by default) */
            border-radius: 30px;
            padding: 35px 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15); /* Soft shadow */
            border: 4px solid #FFB6C1; /* Light pink border (Light Mode by default) */
            position: relative;
            overflow: hidden;
            transition: background 0.5s ease-in-out, border-color 0.5s ease-in-out; /* Smooth transition */
        }
        
        /* Top border with animated rainbow effect */
        .content-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: linear-gradient(90deg, #FF69B4, #DDA0DD, #87CEEB, #FFD700, #FF69B4);
            background-size: 200% 100%;
            animation: rainbow 3s linear infinite;
        }
        
        /* Animation for the rainbow border */
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        /* Header section */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        /* Mascot/logo container */
        .capybobba-mascot {
            width: 250px; 
            height: 250px; 
            margin: 0 auto 0;
            position: relative;
            overflow: hidden;
            background: none; /* No fixed background for logos to show without interference */
            display: flex; /* To center the possible emoji fallback if no image loads */
            align-items: center;
            justify-content: center;
            font-size: 150px; /* Capybara emoji size if images don't load */
        }

        /* Base styles for logo images */
        .capybobba-mascot img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Adjusts the image within the container */
            position: absolute; /* To overlap and control visibility */
            top: 0;
            left: 0;
            transition: opacity 0.3s ease-in-out; /* Smooth transition when changing logo */
        }

        /* By default (Light Mode), shows the light logo and hides the dark one */
        #logoLight {
            opacity: 1; 
            z-index: 2; /* Ensures it's on top */
        }

        #logoDark {
            opacity: 0;
            z-index: 1; /* Will be below the light logo by default */
        }
        
        /* Media query rule for Dark Mode */
        @media (prefers-color-scheme: dark) {
            /* Changes body background to a dark tone */
            body {
                background: linear-gradient(180deg, #333333 0%, #1a1a1a 100%);
            }
            /* Adjusts background and border of the main container for dark mode */
            .content-wrapper {
                background: rgba(45, 45, 45, 0.98); /* Semi-transparent dark background */
                border-color: #9370DB; /* Purple border for contrast */
            }

            /* In dark mode, oculta el logo claro y muestra el oscuro */
            #logoLight {
                opacity: 0;
            }
            #logoDark {
                opacity: 1;
            }

            /* You can also adjust general text colors if necessary for dark mode */
            .main-title, .tagline, .section-title, .flavor-name, .flavor-description, .topping-name, .topping-description, .whatsapp-text, .whatsapp-number, .whatsapp-click-legend, .order-step, .final-message, .promotion-item-title, .promotion-item-description {
                /* Ensures texts are readable on dark backgrounds */
                color: #F0F0F0; /* Soft white */
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Shadow for better readability */
            }

            /* Gradient adjustment for the main title in dark mode */
            .main-title {
                background: linear-gradient(135deg, #FFB6C1, #87CEEB, #DDA0DD); /* Lighter gradient */
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            /* Adjustment for the tagline */
            .tagline {
                color: #DDA0DD; /* Lilac tone for contrast */
            }
            /* Adjustment for section titles */
            .section-title {
                color: #87CEEB; /* Light blue tone for contrast */
            }
            /* Adjustment for descriptions and legends in dark mode */
            .section-description, .click-legend, .flavor-description, .topping-description {
                color: #B0B0B0; /* Light gray for readability */
            }
            /* Adjustment of section background in dark mode */
            .menu-section {
                background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
                border-color: #9370DB;
            }
            .flavor-item {
                background: #3a3a3a;
                border-color: #9370DB;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            }
            .flavor-item:hover {
                border-color: #87CEEB;
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            }
            .hot-drinks {
                background: linear-gradient(135deg, #444444, #555555);
                border-color: #87CEEB;
            }
            .toppings-section {
                background: linear-gradient(135deg, #2c2c2c, #3c3c3c);
                border-color: #87CEEB;
            }
            .topping-item {
                background: rgba(60, 60, 60, 0.9);
                border-color: #87CEEB;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }
            .order-steps {
                background: rgba(80, 80, 80, 0.15);
                border-color: rgba(255, 255, 255, 0.3);
            }
            .order-step {
                color: #E0E0E0;
            }

            /* New styles for promotions in dark mode */
            .promotions-section {
                background: linear-gradient(135deg, #4b2a4b, #6a4a6a); /* Darker background for promotions */
                border-color: #FFB6C1; /* Light pink border */
            }

            .promotion-item {
                background: rgba(80, 80, 80, 0.9); /* Darker background for promotion items */
                border-color: #DDA0DD; /* Lilac border */
            }

            .promotion-item:hover {
                border-color: #FF69B4; /* Strong pink border on hover */
            }

            .promotion-item-title {
                color: #FFB6C1; /* Light pink tone for promotion title */
            }

            .promotion-item-description {
                color: #E0E0E0; /* Light text for promotion description */
            }
        }
        
        /* Floating heart on the mascot */
        .capybobba-mascot::after {
            content: 'üíï';
            position: absolute;
            font-size: 65px; 
            top: -20px;      
            right: -20px;    
            animation: float 2s ease-in-out infinite; /* Floating animation */
            z-index: 3; /* Ensures it's on top of logos */
        }
        
        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        /* Main menu title */
        .main-title {
            font-size: 52px;
            font-weight: 900;
            background: linear-gradient(135deg, #FF1493, #9370DB, #00CED1); /* Text color gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -1px;
        }
        
        /* Subtitle/slogan */
        .tagline {
            font-size: 26px;
            font-weight: 700;
            color: #FF69B4; /* Cherry pink */
            margin-bottom: 25px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* Menu section style */
        .menu-section {
            margin-bottom: 45px;
            background: linear-gradient(135deg, #FFF8F0, #F0F8FF); /* Soft background */
            border-radius: 25px;
            padding: 30px 25px;
            border: 3px solid #FFB6C1;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        /* Animated border for sections */
        .menu-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #FFB6C1, #DDA0DD, #87CEEB, #FFD700);
            border-radius: 25px;
            z-index: -1;
            animation: borderGlow 3s linear infinite; /* Border glow animation */
        }
        
        /* Border glow animation */
        @keyframes borderGlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        /* Section header */
        .section-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        /* Section title */
        .section-title {
            font-size: 30px;
            font-weight: 800;
            color: #FF1493; /* Strong pink */
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
        }
        
        /* Price banner */
        .price-banner {
            background: linear-gradient(135deg, #FFD700, #FFA500, #FF6347); /* Orange to red gradient */
            color: white;
            font-size: 26px;
            font-weight: 800;
            padding: 18px 25px;
            border-radius: 20px;
            margin: 20px auto;
            display: inline-block;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            border: 3px solid white;
            max-width: fit-content;
        }
        
        /* Section description */
        .section-description {
            font-size: 18px;
            color: #8B4513; /* Dark brown */
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* Legend for clicking on flavors */
        .click-legend {
            font-size: 14px; /* Smaller font */
            color: #8B4513;
            text-align: center;
            margin-bottom: 15px; /* Space before the flavor grid */
            font-style: italic;
            font-weight: 600;
        }
        
        /* Flavor items in the grid */
        .flavor-grid {
            display: grid;
            gap: 20px; /* Space between elements */
            margin-top: 25px;
        }
        
        /* Individual flavor item */
        .flavor-item {
            background: white;
            border-radius: 20px;
            padding: 22px 20px;
            border: 3px solid #FFB6C1;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease; /* Smooth transition for hover */
            position: relative;
            overflow: hidden;
            /* Changed to flexbox to align name, description and button */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Pushes button to bottom */
            cursor: pointer; /* Keep cursor for image display click */
        }
        
        /* Glow effect on hover */
        .flavor-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 182, 193, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .flavor-item:hover::before {
            left: 100%;
        }
        
        .flavor-item:hover {
            transform: translateY(-8px); /* Lift on hover */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border-color: #FF69B4;
        }
        
        .flavor-name {
            font-size: 22px;
            font-weight: 800;
            color: #FF1493;
            margin-bottom: 12px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .flavor-description {
            font-size: 17px;
            color: #8B4513;
            line-height: 1.4;
            font-weight: 600;
            margin-bottom: 15px; /* Space before the button */
        }

        /* "Add to Cart" button style for drinks */
        .add-drink-to-cart-button {
            background: linear-gradient(45deg, #9370DB, #87CEEB); /* Purple to light blue gradient */
            color: white;
            font-size: 18px;
            font-weight: 700;
            padding: 10px 15px;
            border-radius: 15px;
            border: 2px solid white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            width: fit-content; /* Adjust width to content */
            align-self: center; /* Center the button in flex container */
            margin-top: auto; /* Push button to the bottom if content is uneven */
            display: flex; /* For icon and text alignment */
            align-items: center;
            gap: 8px;
        }

        .add-drink-to-cart-button:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #87CEEB, #9370DB); /* Invert gradient on hover */
        }

        /* Styles for the "Added!" feedback state */
        .add-drink-to-cart-button.added-feedback {
            background: linear-gradient(45deg, #4CAF50, #8BC34A); /* Lighter green */
            transition: none; /* No transition for this state change */
            transform: none; /* No transform during feedback */
            box-shadow: none; /* No shadow during feedback */
        }
        
        /* Hot drinks section */
        .hot-drinks {
            background: linear-gradient(135deg, #FFF8DC, #F0E68C); /* Soft yellow background */
            border: 3px solid #DDA0DD; /* Lilac border */
        }

        /* Toppings section */
        .toppings-section {
            background: linear-gradient(135deg, #E6E6FA, #F0F8FF); /* Soft light blue background */
            border: 3px solid #9370DB; /* Purple border */
        }
        
        /* Toppings title */
        .toppings-title {
            color: #9370DB; /* Purple */
            text-align: center;
            margin-bottom: 25px;
        }
        
        /* Price for topping item */
        .topping-price {
            background: linear-gradient(135deg, #32CD32, #00CED1); /* Green to blue gradient */
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 20px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 0 10px;
        }
        
        /* Individual topping item (now for display only, added via modal) */
        .topping-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 18px;
            padding: 18px 20px;
            margin-bottom: 18px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            /* Removed flexbox stuff here as buttons are gone from main topping list */
        }
        
        .topping-item:hover {
            transform: translateX(10px); /* Slide on hover */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .topping-name {
            font-size: 20px;
            font-weight: 800;
            color: #9370DB;
            margin-bottom: 10px;
        }
        
        .topping-description {
            font-size: 16px;
            color: #8B4513;
            line-height: 1.4;
            /* Removed margin-bottom here as no button below */
        }
        
        /* Styles for the Promotions and News section */
        .promotions-section {
            background: linear-gradient(135deg, #FFC0CB, #ADD8E6); /* Light pink to light blue */
            border: 3px solid #FF69B4; /* Strong pink border */
        }

        .promotion-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 22px 20px;
            margin-bottom: 18px;
            border: 3px solid #FFB6C1;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer; /* Added cursor to indicate it's clickable */
        }

        .promotion-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
            border-color: #FF1493;
        }

        .promotion-item-title {
            font-size: 24px;
            font-weight: 800;
            color: #FF1493; /* Strong pink */
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .promotion-item-description {
            font-size: 17px;
            color: #8B4513;
            line-height: 1.4;
            font-weight: 600;
        }

        /* --- Shopping Cart Section Styles --- */
        .shopping-cart-section {
            margin-top: 45px;
            margin-bottom: 45px;
            background: linear-gradient(135deg, #E0F2FE, #F3E8FF); /* Light blue to light purple */
            border-radius: 25px;
            padding: 30px 25px;
            border: 3px solid #87CEEB; /* Light blue border */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .shopping-cart-section .section-title {
            color: #007BFF; /* Blue for cart title */
            margin-bottom: 20px;
        }

        .cart-items-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            max-height: 250px; /* Limit height for scrollable area */
            overflow-y: auto; /* Enable vertical scrolling */
            border: 1px dashed #B0C4DE; /* Light blue dashed border */
            border-radius: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7); /* Slightly transparent background */
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* Align items to start, useful for multiline topping lists */
            padding: 10px 0;
            border-bottom: 1px solid #E0E0E0;
            font-size: 17px;
            font-weight: 600;
            color: #333;
            flex-direction: column; /* Stack name/toppings and price/remove vertically initially */
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .item-main-info {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 5px;
        }

        .item-quantity {
            font-weight: 800;
            color: #FF69B4; /* Pink for quantity */
            margin-right: 10px;
            min-width: 30px; /* Ensure space for quantity */
            text-align: right;
        }

        .item-name {
            flex-grow: 1; /* Allows name to take available space */
            text-align: left;
        }

        .item-details {
            width: 100%; /* Take full width below main info */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 40px; /* Indent to align with item name */
        }

        .item-toppings {
            font-size: 14px;
            color: #8B4513; /* Brownish for toppings */
            text-align: left;
            margin-top: 5px;
            flex-grow: 1;
        }

        .item-price {
            font-weight: 800;
            color: #32CD32; /* Green for price */
            margin-left: 10px;
            white-space: nowrap; /* Prevent price from wrapping */
        }

        .remove-item-button {
            background: #FF6347; /* Orange-red for remove button */
            color: white;
            border: none;
            border-radius: 50%; /* Circular button */
            width: 28px;
            height: 28px;
            font-size: 16px;
            font-weight: 900;
            cursor: pointer;
            transition: background 0.2s ease;
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .remove-item-button:hover {
            background: #FF4500;
            transform: scale(1.05);
        }

        .cart-total {
            font-size: 24px;
            font-weight: 900;
            color: #FF1493; /* Strong pink for total */
            margin-top: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .cart-actions {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .cart-action-button {
            background: linear-gradient(45deg, #FFD700, #FFA500); /* Gold to Orange */
            color: white;
            font-size: 20px;
            font-weight: 800;
            padding: 15px 25px;
            border-radius: 20px;
            border: 3px solid white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .cart-action-button.clear-cart {
            background: linear-gradient(45deg, #FF69B4, #DDA0DD); /* Pink to Lilac */
        }
        .cart-action-button.order-whatsapp-button {
            background: linear-gradient(45deg, #25D366, #128C7E); /* WhatsApp green */
        }
        
        .cart-action-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }
        .cart-action-button.clear-cart:hover {
            background: linear-gradient(45deg, #DDA0DD, #FF69B4);
        }
        .cart-action-button.order-whatsapp-button:hover {
            background: linear-gradient(45deg, #128C7E, #25D366);
        }
        /* --- End Shopping Cart Section Styles --- */


        /* Order section */
        .order-section {
            background: linear-gradient(135deg, #FF69B4, #9370DB, #00CED1); /* Multicolor gradient */
            color: white;
            text-align: center;
            border-radius: 30px;
            padding: 40px 30px;
            margin-top: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
            border: 4px solid white;
            position: relative;
            overflow: hidden;
        }
        
        /* Bubble pattern background for the order section */
        .order-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.3"/><circle cx="80" cy="40" r="1.5" fill="white" opacity="0.4"/><circle cx="40" cy="70" r="1" fill="white" opacity="0.3"/><circle cx="70" cy="80" r="2.5" fill="white" opacity="0.2"/></svg>');
            z-index: 1;
        }
        
        .order-content {
            position: relative;
            z-index: 2;
        }
        
        /* Order section title */
        .order-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 25px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
            line-height: 1.2;
        }
        
        /* WhatsApp section (this section now mainly shows the number and steps) */
        .whatsapp-section {
            margin: 30px 0;
        }
        
        .whatsapp-text {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* Estilos para el enlace de WhatsApp (now only used for the raw number display) */
        .whatsapp-link {
            text-decoration: none;
            color: white;
        }

        /* WhatsApp number (no longer a button) */
        .whatsapp-number {
            background: #25D366; /* WhatsApp Green */
            color: white;
            font-size: 32px;
            font-weight: 900;
            padding: 25px 30px;
            border-radius: 25px;
            display: inline-block;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            border: 4px solid white;
            letter-spacing: 1px;
            /* Removed pulse animation from here as the main order button will have it */
            
            /* Usar flexbox para organizar el n√∫mero y la leyenda */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1; /* Adjust line-height so the legend doesn't have too much space */
        }

        /* Style for the new legend inside the WhatsApp number block */
        .whatsapp-click-legend {
            font-size: 14px; /* Smaller font */
            font-weight: 600; /* Semi-bold */
            color: rgba(255, 255, 255, 0.8); /* Slightly transparent white */
            margin-top: 5px; /* Space between the number and the legend */
            text-shadow: none; /* Remove shadow if inherited from parent */
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Order steps */
        .order-steps {
            background: rgba(255, 255, 255, 0.15); /* Semi-transparent background */
            border-radius: 20px;
            padding: 25px;
            margin: 30px auto;
            max-width: 650px;
            backdrop-filter: blur(10px); /* Blur effect */
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .order-step {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 18px;
            text-align: left;
            padding-left: 15px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            line-height: 1.4;
        }
        
        .order-step:last-child {
            margin-bottom: 0;
        }
        
        /* Final message */
        .final-message {
            background: linear-gradient(135deg, #FFD700, #FFA500, #FF6347);
            color: white;
            text-align: center;
            padding: 35px 25px;
            border-radius: 25px;
            margin-top: 35px;
            font-size: 19px;
            font-weight: 700;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            border: 3px solid white;
            line-height: 1.5;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .final-message .highlight {
            font-size: 22px;
            font-weight: 800;
            display: block;
            margin-top: 20px;
        }
        
        /* Dividers with animated emojis */
        .kawaii-divider {
            text-align: center;
            margin: 40px 0;
            font-size: 30px;
        }
        
        .kawaii-divider .emoji {
            display: inline-block;
            margin: 0 15px;
            animation: bounce 2s infinite; /* Bounce animation */
        }
        
        .kawaii-divider .emoji:nth-child(2) {
            animation-delay: 0.3s;
        }
        
        .kawaii-divider .emoji:nth-child(3) {
            animation-delay: 0.6s;
        }
        
        /* Bounce animation */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            /* Widths are already fluid, they adjust automatically */
            
            .menu-container {
                padding: 15px 10px; /* Smaller padding on mobile */
            }
            
            .content-wrapper {
                padding: 25px 20px;
            }
            
            .main-title {
                font-size: 42px; /* Font size reduction for main title */
            }
            
            .section-title {
                font-size: 26px; /* Font size reduction for section titles */
            }
            
            .price-banner {
                font-size: 22px;
                padding: 15px 20px;
            }
            
            /* Adjusted WhatsApp number display for mobile as it's no longer the main order button */
            .whatsapp-number {
                font-size: 24px;
                padding: 15px 20px;
            }
            .whatsapp-click-legend {
                font-size: 10px; /* Even smaller for legend */
            }
            
            .order-title {
                font-size: 30px;
            }
            
            .capybobba-mascot {
                width: 200px;
                height: 200px;
                font-size: 120px;
            }

            .capybobba-mascot::after {
                font-size: 50px;
                top: -15px;
                right: -15px;
            }

            .flavor-image-content, .hot-drinks-image-content, .topping-selection-content {
                width: 90%; /* Ensures the container is not too large */
                max-width: 300px;
                padding: 20px;
            }

            .add-drink-to-cart-button, .cart-action-button {
                font-size: 16px;
                padding: 10px 15px;
            }
            .cart-action-button {
                width: 100%; /* Full width buttons on small screens */
            }

            .add-topping-button {
                font-size: 14px;
                padding: 8px 12px;
            }
        }
        
        /* Print/screenshot optimizations */
        @media print {
            body {
                background: white; /* White background for printing */
            }
            
            .kawaii-decoration {
                display: none; /* Hides floating decorations */
            }
        }

        /* --- Styles for flavor image viewer (overlay) --- */
        .flavor-image-overlay, .hot-drinks-image-overlay, .topping-selection-overlay {
            position: fixed; /* Fixed on screen */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Semi-transparent dark background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Ensures it's on top of everything */
            opacity: 0; /* Initially hidden */
            pointer-events: none; /* Not interactable when hidden */
            transition: opacity 0.3s ease-in-out; /* Smooth transition for showing/hiding */
        }

        .flavor-image-overlay.show, .hot-drinks-image-overlay.show, .topping-selection-overlay.show {
            opacity: 1; /* Shows the overlay */
            pointer-events: auto; /* Allows interaction when visible */
        }

        .flavor-image-content, .hot-drinks-image-content, .topping-selection-content {
            background: rgba(255, 255, 255, 0.95); /* Almost opaque white background */
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 4px solid #FF69B4; /* Vibrant pink border */
            max-width: 400px; 
            width: 80%; /* Fluid width */
            transform: scale(0.9); /* Slightly smaller initially */
            opacity: 0; /* Added for smooth content transition */
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; /* Transition for scaling and opacity */
        }

        .flavor-image-overlay.show .flavor-image-content, 
        .hot-drinks-image-overlay.show .hot-drinks-image-content,
        .topping-selection-overlay.show .topping-selection-content {
            transform: scale(1); /* Normal scale when showing */
            opacity: 1; /* Transiciona a opacidad completa al mostrar */
        }

        .flavor-image-content img, .hot-drinks-image-content img {
            max-width: 100%; /* Ensures the image doesn't overflow */
            height: auto;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            object-fit: contain; /* Shows the complete image without cropping */
        }

        .flavor-image-name {
            font-size: 28px;
            font-weight: 800;
            color: #FF1493;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Style for the hot drinks image name */
        .hot-drinks-name {
            font-size: 28px;
            font-weight: 800;
            color: #FF1493; /* Strong pink, matching flavor names */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); /* Subtle shadow for definition */
            margin-top: 10px; /* Add some space above the text */
        }
        /* Ensure dark mode also adjusts this text color */
        @media (prefers-color-scheme: dark) {
            .hot-drinks-name {
                color: #FFB6C1; /* A light pink for dark mode for better visibility */
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Slightly stronger shadow for contrast on dark */
            }
        }

        /* --- Topping Selection Modal Styles --- */
        .topping-selection-content .section-title {
            color: #9370DB; /* Purple for topping modal title */
        }

        .current-drink-name-modal {
            font-size: 22px;
            font-weight: 700;
            color: #FF69B4; /* Pink for current drink name */
            margin-bottom: 20px;
        }

        .toppings-modal-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px dashed #DDA0DD;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.8);
        }

        .topping-modal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #F9F0FF; /* Very light purple */
            border-radius: 12px;
            padding: 12px 15px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        .topping-modal-item.selected {
            border: 2px solid #9370DB; /* Highlight selected toppings */
            background: #E6E6FA; /* Slightly darker background */
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        }

        .topping-modal-name {
            font-size: 18px;
            font-weight: 700;
            color: #9370DB;
            flex-grow: 1;
            text-align: left;
        }

        .topping-modal-price {
            font-size: 16px;
            font-weight: 600;
            color: #32CD32;
            margin-left: 10px;
            white-space: nowrap;
        }

        .add-topping-button {
            background: linear-gradient(45deg, #00CED1, #87CEEB); /* Teal to light blue */
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .add-topping-button.remove {
            background: linear-gradient(45deg, #FF6347, #FF4500); /* Orange-red */
        }

        .add-topping-button:hover {
            transform: scale(1.03);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }

        .topping-selection-actions {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .topping-selection-actions button {
            font-size: 18px;
            padding: 12px 20px;
            border-radius: 18px;
            border: 2px solid white;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .topping-selection-actions button:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        #confirmToppingsButton {
            background: linear-gradient(45deg, #25D366, #128C7E); /* Green for confirm */
        }
        #confirmToppingsButton:hover {
            background: linear-gradient(45deg, #128C7E, #25D366);
        }

        #noToppingsButton {
            background: linear-gradient(45deg, #FFA500, #FFD700); /* Orange for no toppings */
        }
        #noToppingsButton:hover {
            background: linear-gradient(45deg, #FFD700, #FFA500);
        }

        #cancelToppingsButton {
            background: linear-gradient(45deg, #FF69B4, #FF1493); /* Pink for cancel */
        }
        #cancelToppingsButton:hover {
            background: linear-gradient(45deg, #FF1493, #FF69B4);
        }
        /* --- End Topping Selection Modal Styles --- */

    </style>
</head>
<body>
    <!-- Kawaii floating decorations -->
    <div class="kawaii-decoration bubble-tea-cup"></div>
    <div class="kawaii-decoration capybara-float-1">üêπ</div>
    <div class="kawaii-decoration capybara-float-2">üêπ</div>
    <div class="kawaii-decoration heart-float">üíï</div>
    
    <div class="menu-container">
        <div class="content-wrapper">
            <!-- Header -->
            <div class="header">
                <div class="capybobba-mascot">
                    <!-- Image for light mode (visible by default) -->
                    <img id="logoLight" src="https://i.imgur.com/llR0NN0.png" 
                         alt="Capibobba Logo Modo Claro">
                    <!-- Image for dark mode (hidden by default) -->
                    <img id="logoDark" src="https://i.imgur.com/i7psA3z.png" 
                         alt="Capibobba Logo Modo Oscuro">
                </div>
                <h1 class="main-title">MEN√ö CAPIBOBBA</h1>
                <div class="tagline">¬°Dale un abrazo a tu bebida favorita! üß∏üíï</div>
            </div>
            
            <!-- Decorative divider -->
            <div class="kawaii-divider">
                <span class="emoji">üåü</span>
                <span class="emoji">‚ú®</span>
                <span class="emoji">üåü</span>
            </div>
            
            <!-- Secci√≥n de Frapp√©s base agua -->
            <section class="menu-section">
                <div class="section-header">
                    <div class="section-title">üçπ‚ú® Frapp√©s m√°gicos base agua - 16oz ‚ú®üçπ</div>
                    <div class="price-banner">$75 (Incluye hielo ‚ùÑÔ∏è y ternura)</div>
                    <div class="section-description">
                        Refrescantes, frutales y muuuy kawaii üíñ<br>
                        Ideal para d√≠as soleados üåû
                    </div>
                    <!-- Leyenda para click en sabores (mantengo para la imagen, pero el pedido es por bot√≥n) -->
                    <div class="click-legend">da click en los sabores para ver una imagen de la boba</div>
                </div>
                
                <div class="flavor-grid">
                    <div class="flavor-item" data-name="Frapp√© Litchi (Agua)" data-price="75">
                        <div class="flavor-name">Litchi</div>
                        <div class="flavor-description">Dulce y ex√≥tico como un abrazo frutal de nube ‚òÅÔ∏èüíï (¬°pru√©balo si no lo conoces!)</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Fresa (Agua)" data-price="75">
                        <div class="flavor-name">Fresa</div>
                        <div class="flavor-description">El cl√°sico m√°s tierno üçìüíñ ¬°como una caricia de fresita!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Blueberry (Agua)" data-price="75">
                        <div class="flavor-name">Blueberry</div>
                        <div class="flavor-description">Dulzura encantadora con un toque de magia azul üíôü´ê</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Mango (Agua)" data-price="75">
                        <div class="flavor-name">Mango</div>
                        <div class="flavor-description">Tropical y juguet√≥n ü•≠‚òÄÔ∏è ¬°Pura alegr√≠a l√≠quida!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Pi√±a Colada (Agua)" data-price="75">
                        <div class="flavor-name">Pi√±a colada</div>
                        <div class="flavor-description">Vacaciones kawaii en cada sorbo üççü•• ¬°fresca y coqueta!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Maracuy√° (Agua)" data-price="75">
                        <div class="flavor-name">Maracuy√°</div>
                        <div class="flavor-description">√Åcida y divertida, perfecta para los m√°s atrevidos üíõ‚ú®</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>

                    <!-- Nuevo sabor: Guan√°bana -->
                    <div class="flavor-item" data-name="Frapp√© Guan√°bana (Agua)" data-price="75">
                        <div class="flavor-name">Guan√°bana</div>
                        <div class="flavor-description">Ex√≥tica y refrescante, con un dulzor suave y cremoso üíö‚ú®</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>

                    <!-- Nuevo sabor: Sand√≠a -->
                    <div class="flavor-item" data-name="Frapp√© Sand√≠a (Agua)" data-price="75">
                        <div class="flavor-name">Sand√≠a</div>
                        <div class="flavor-description">Refrescante y dulce, el sabor del verano en cada sorbo üçâ‚òÄÔ∏è</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                </div>
            </section>
            
            <!-- Decorative divider -->
            <div class="kawaii-divider">
                <span class="emoji">üåà</span>
                <span class="emoji">üßã</span>
                <span class="emoji">üåà</span>
            </div>
            
            <!-- Secci√≥n de Frapp√©s base leche -->
            <section class="menu-section">
                <div class="section-header">
                    <div class="section-title">üçºüí´ Frapp√©s m√°gicos base leche - 16oz üí´üçº</div>
                    <div class="price-banner">$75 (Cremositos, dulces y s√∫per abrazables ü§ç)</div>
                    <div class="section-description">¬°Una nube cremosa con sabor! üßãüê∞</div>
                    <!-- Leyenda para click en sabores (mantengo para la imagen, pero el pedido es por bot√≥n) -->
                    <div class="click-legend">da click en los sabores para ver una imagen de la boba</div>
                </div>
                
                <div class="flavor-grid">
                    <!-- Nuevo sabor: Chocolate Mexicano (MOVido al principio) -->
                    <div class="flavor-item" data-name="Frapp√© Chocolate Mexicano (Leche)" data-price="75">
                        <div class="flavor-name">Chocolate Mexicano</div>
                        <div class="flavor-description">El toque tradicional de cacao con canela y un secreto de la abuela üç´üå∂Ô∏è‚ú®</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>

                    <div class="flavor-item" data-name="Frapp√© Taro (Leche)" data-price="75">
                        <div class="flavor-name">Taro</div>
                        <div class="flavor-description">Cremoso y delicado  üå∞üíú (¬°tu nuevo favorito si no lo conoces!)</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Mazap√°n (Leche)" data-price="75">
                        <div class="flavor-name">Mazap√°n</div>
                        <div class="flavor-description">Sabor a infancia mexicana üé†üíï ¬°un apapacho de cacahuate!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Chai (Leche)" data-price="75">
                        <div class="flavor-name">Chai</div>
                        <div class="flavor-description">Especiado y c√°lido ‚òï‚ú® ¬°ideal para d√≠as nublados!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Mocha (Leche)" data-price="75">
                        <div class="flavor-name">Mocha</div>
                        <div class="flavor-description">Caf√© y chocolate en perfecta armon√≠a üç´‚òïüíû</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Cookies & Cream (Leche)" data-price="75">
                        <div class="flavor-name">Cookies & Cream</div>
                        <div class="flavor-description">Como beber una galleta con leche üç™ü•õ ¬°√±am!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Crema Irlandesa (Leche)" data-price="75">
                        <div class="flavor-name">Crema Irlandesa</div>
                        <div class="flavor-description">Cremosa y misteriosa üçÆ‚ú® (sin alcohol)</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Frapp√© Matcha (Leche)" data-price="75">
                        <div class="flavor-name">Matcha</div>
                        <div class="flavor-description">T√© verde japon√©s con energ√≠a kawaii üíöüåø ¬°pura paz zen!</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                </div>
            </section>
            
            <!-- Secci√≥n de bebidas calientes - AHORA CON SUS PROPIOS SABORES -->
            <section class="menu-section hot-drinks">
                <div class="section-header">
                    <div class="section-title">‚òïüå∏ Bebidas Calientitas - 12oz üå∏‚òï</div>
                    <div class="price-banner">$60 ‚Äì Ideal para esos d√≠as de fr√≠o o lluvia ‚òîüåßÔ∏è</div>
                    <div class="section-description">
                        ¬°Calientitas, reconfortantes y adorables para abrazar tu d√≠a! üíï
                    </div>
                    <div class="click-legend">da click en los sabores para ver una imagen de la bebida</div>
                </div>
                
                <div class="flavor-grid">
                    <!-- Nuevo sabor: Chocolate Caliente -->
                    <div class="flavor-item" data-name="Chocolate Caliente" data-price="60">
                        <div class="flavor-name">Chocolate Caliente</div>
                        <div class="flavor-description">El abrazo m√°s dulce y c√°lido en una taza üç´‚òïüíñ</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <!-- Sabores base leche como bebidas calientes -->
                    <div class="flavor-item" data-name="Taro Caliente" data-price="60">
                        <div class="flavor-name">Taro Caliente</div>
                        <div class="flavor-description">Cremoso y delicado, perfecto para el fr√≠o üå∞üíú</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Mazap√°n Caliente" data-price="60">
                        <div class="flavor-name">Mazap√°n Caliente</div>
                        <div class="flavor-description">Sabor a infancia mexicana, ahora calientito üé†üíï</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Chai Caliente" data-price="60">
                        <div class="flavor-name">Chai Caliente</div>
                        <div class="flavor-description">Especiado y reconfortante, un cl√°sico invernal ‚ú®‚òï</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Mocha Caliente" data-price="60">
                        <div class="flavor-name">Mocha Caliente</div>
                        <div class="flavor-description">La combinaci√≥n perfecta de caf√© y chocolate, caliente y delicioso ‚òïüç´</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Cookies & Cream Caliente" data-price="60">
                        <div class="flavor-name">Cookies & Cream Caliente</div>
                        <div class="flavor-description">Como beber una galleta con leche, pero calientita üç™ü•õ</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Crema Irlandesa Caliente" data-price="60">
                        <div class="flavor-name">Crema Irlandesa Caliente</div>
                        <div class="flavor-description">Cremosa y misteriosa, para una tarde acogedora üçÆ‚ú®</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                    
                    <div class="flavor-item" data-name="Matcha Caliente" data-price="60">
                        <div class="flavor-name">Matcha Caliente</div>
                        <div class="flavor-description">T√© verde japon√©s con energ√≠a zen, calientito y reconfortante üíöüåø</div>
                        <button class="add-drink-to-cart-button">A√±adir üíñ</button>
                    </div>
                </div>
            </section>

            <!-- Decorative divider for the new section -->
            <div class="kawaii-divider">
                <span class="emoji">üíñ</span>
                <span class="emoji">‚ú®</span>
                <span class="emoji">üéâ</span>
            </div>

            <!-- Nueva Secci√≥n de Promociones y Novedades -->
            <section class="menu-section promotions-section">
                <div class="section-header">
                    <div class="section-title">üåü Novedades Kawaii y Promociones Exclusivas üåü</div>
                    <div class="section-description">
                        ¬°No te pierdas las √∫ltimas sorpresas y ofertas m√°s tiernas de Capibobba! ‚ú®
                    </div>
                </div>
                
                <!-- Frapp√© de Temporada con ID para el evento click -->
                <!-- PRECIO ACTUALIZADO A $75 y texto del bot√≥n cambiado -->
                <div class="promotion-item" id="fresasConCremaPromotion" data-name="Frapp√© Fresas con Crema (Temporada)" data-price="75">
                    <div class="promotion-item-title">üçìü•õ Frapp√© de Temporada: "Fresas con Crema" üçìü•õ</div>
                    <div class="promotion-item-description">
                        ¬°El cl√°sico favorito de la abuela, pero en versi√≥n kawaii! Disfruta de la dulzura de la fresa natural combinada con la cremosidad m√°s suave. ¬°Un abrazo de fresas y amor en cada sorbo! Disponible solo por tiempo limitado.üíñ‚ú®
                    </div>
                    <!-- Se ha a√±adido un estilo inline para centrar el bot√≥n aqu√≠ -->
                    <button class="add-drink-to-cart-button" style="margin-top: 15px; margin: 15px auto 0;">A√±adir üíñ</button>
                </div>

                <div class="promotion-item">
                    <div class="promotion-item-title">üéÅ Descuento por Primer Pedido üéÅ</div>
                    <div class="promotion-item-description">
                        ¬°Bienvenido a la familia Capibobba! Obt√©n un 10% de descuento en tu primer pedido usando el c√≥digo: **KAWAII10** al hacer tu encargo por WhatsApp. ü•≥
                    </div>
                </div>
            </section>
            
            <!-- Secci√≥n de Toppings (now for display only, added via modal) -->
            <section class="menu-section toppings-section">
                <div class="section-header">
                    <div class="section-title">üåàüßã ¬°Hazla tuya! Personaliza tu bebida üßãüåà</div>
                    <div class="toppings-title">
                        <span style="font-size: 24px; font-weight: 800;">üíñ Toppings kawaii</span>
                        <span class="topping-price">+$10 cada uno</span>
                    </div>
                    <div class="section-description">
                        Selecciona estos toppings despu√©s de elegir tu bebida. ¬°No se pueden a√±adir solos al carrito!
                    </div>
                </div>
                
                <div class="topping-item">
                    <div class="topping-name">üí• Perlas explosivas de frutos rojos</div>
                    <div class="topping-description">Dulces mini-explosiones de amor ‚ù§Ô∏èü´ß</div>
                </div>
                
                <div class="topping-item">
                    <div class="topping-name">üçè Perlas explosivas de manzana verde</div>
                    <div class="topping-description">¬°Explosi√≥n y frescura en cada sorbo! üçè‚ú®</div>
                </div>
                
                <div class="topping-item">
                    <div class="topping-name">ü§ç Perlas explosivas de litchi</div>
                    <div class="topping-description">Delicadas, frutales y muuuy adorables üç°üíñ</div>
                </div>
                
                <div class="topping-item">
                    <div class="topping-name">üåà Jelly arcoiris</div>
                    <div class="topping-description">Suavecitos, coloridos y s√∫per divertidos üêªüåà</div>
                </div>
            </section>

            <!-- Decorative divider -->
            <div class="kawaii-divider">
                <span class="emoji">‚ú®</span>
                <span class="emoji">üõí</span>
                <span class="emoji">‚ú®</span>
            </div>

            <!-- --- Shopping Cart Section --- -->
            <section class="menu-section shopping-cart-section">
                <div class="section-header">
                    <div class="section-title">üíñ Tu Carrito Kawaii üíñ</div>
                </div>
                <ul id="cartItemsList" class="cart-items-list">
                    <!-- Cart items will be dynamically added here -->
                    <li style="text-align: center; color: #6b7280;">¬°Tu carrito est√° vac√≠o, a√±ade algo delicioso! üíñ</li>
                </ul>
                <div id="cartTotal" class="cart-total">Total: $0</div>

                <div class="cart-actions">
                    <button id="clearCartButton" class="cart-action-button clear-cart">
                        Vaciar Carrito üóëÔ∏è
                    </button>
                    <button id="orderWhatsAppButton" class="cart-action-button order-whatsapp-button">
                        Pedir por WhatsApp üì±
                    </button>
                </div>
            </section>
            <!-- --- End Shopping Cart Section --- -->
            
            <!-- Secci√≥n de c√≥mo ordenar (ahora con el n√∫mero al final) -->
            <section class="order-section">
                <div class="order-content">
                    <div class="order-title">‚ú®üß∏ C√ìMO ORDENAR TU BEBIDA KAWAII üß∏‚ú®</div>
                    
                    <div class="order-steps">
                        <div class="order-step">1. Elige tu bebida (frapp√© o caliente) y agr√©gala al carrito.</div>
                        <div class="order-step">2. Si deseas, selecciona toppings para esa bebida en la ventana emergente.</div>
                        <div class="order-step">3. Repite para cada bebida que quieras.</div>
                        <div class="order-step">
                            4. Cuando est√©s listo, haz clic en "Pedir por WhatsApp" para enviar tu orden autom√°ticamente.
                        </div>
                        <div class="order-step">
                            5. Recibe tu bebida y toma muchas fotos! Y etiqueta a <a href="https://www.facebook.com/share/195krrAWVG/" target="_blank" style="color: inherit; text-decoration: underline;">@Capibobba</a>, m√°ndanos tu post y gana un <strong>$10 de descuento</strong> en tu siguiente pedido. üì∏üíï
                        </div>
                    </div>

                    <!-- Secci√≥n de WhatsApp (movida al final de las instrucciones) -->
                    <div class="whatsapp-section">
                        <div class="whatsapp-text">Nuestro n√∫mero de contacto:</div>
                        <div class="whatsapp-number">
                            7712794633
                            <span class="whatsapp-click-legend">¬°Tambi√©n puedes pedir dando click en "Pedir por WhatsApp" arriba!</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Final message -->
            <div class="final-message">
                <div>
                    > Todos nuestros frapp√©s son servidos con mucho cari√±o y los llevamos a la puerta de tu hogar velozmente üíï<br>
                    El dise√±o de tu bebida siempre ser√° adorable! üêæ
                </div>
                <div class="highlight">
                    ¬øListo para tomar algo tiernamente delicioso? üßã‚ú®<br>
                    ¬°Te esperamos con una sonrisa y un vaso lleno de felicidad! üíñüåü
                </div>
            </div>
        </div>
    </div>

    <!-- Visor de Im√°genes de Sabor (Overlay) -->
    <div id="flavorImageOverlay" class="flavor-image-overlay">
        <div class="flavor-image-content">
            <img id="flavorImage" src="" alt="Sabor de Frapp√©">
            <div class="flavor-image-name" id="flavorImageName"></div>
        </div>
    </div>

    <!-- Topping Selection Modal (NEW) -->
    <div id="toppingSelectionOverlay" class="topping-selection-overlay">
        <div class="topping-selection-content">
            <div class="section-header">
                <div class="section-title">¬°Personaliza tu <span id="toppingDrinkName" class="current-drink-name-modal"></span>!</div>
                <p>Selecciona los toppings que deseas a√±adir a esta bebida:</p>
            </div>
            <div id="toppingsModalGrid" class="toppings-modal-grid">
                <!-- Toppings will be dynamically loaded here by JS -->
            </div>
            <div class="topping-selection-actions">
                <button id="confirmToppingsButton">Confirmar Selecci√≥n ‚úÖ</button>
                <button id="noToppingsButton">Sin Toppings üö´</button>
                <button id="cancelToppingsButton">Cancelar ‚ùå</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Helper function to generate unique IDs
            function generateUniqueId() {
                return 'item-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            }

            // Logic for theme-based logo display
            function setInitialLogoTheme() {
                const logoLight = document.getElementById('logoLight');
                const logoDark = document.getElementById('logoDark');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (logoLight && logoDark) { // Ensure elements exist before trying to access
                    if (prefersDark) {
                        logoLight.style.opacity = '0';
                        logoDark.style.opacity = '1';
                    } else {
                        logoLight.style.opacity = '1';
                        logoDark.style.opacity = '0';
                    }
                }
            }
            setInitialLogoTheme();

            // Image viewer logic for flavor items
            const flavorItems = document.querySelectorAll('.flavor-item');
            const flavorImageOverlay = document.getElementById('flavorImageOverlay');
            const flavorImage = document.getElementById('flavorImage');
            const flavorImageName = document.getElementById('flavorImageName');
            
            // Define all flavor images. Using a generic hot drinks image for now.
            const genericHotDrinksImage = "https://i.imgur.com/EtT387b.jpeg";

            const flavorImages = {
                "Litchi": "https://i.imgur.com/Pu7yFxo.jpeg", 
                "Fresa": "https://i.imgur.com/UMxtB2o.jpeg",
                "Blueberry": "https://i.imgur.com/XMfisGw.jpeg",
                "Mango": "https://i.imgur.com/VGEGSkT.jpeg",
                "Pi√±a colada": "https://i.imgur.com/U6LUnZt.jpeg",
                "Maracuy√°": "https://i.imgur.com/hrULvVp.jpeg",
                "Guan√°bana": "https://placehold.co/300x300/E0F2FE/555555?text=Guanabana", // Placeholder for Guan√°bana
                "Sand√≠a": "https://i.imgur.com/FwsLeZz.jpeg", // UPDATED IMAGE FOR SAND√çA
                "Chocolate Mexicano": "https://placehold.co/300x300/8B4513/FFFFFF?text=Choco+Mexicano", // Placeholder for Chocolate Mexicano
                "Taro": "https://i.imgur.com/epvVrkT.jpeg", // Updated image URL for Taro
                "Mazap√°n": "https://i.imgur.com/jrELu9J.jpeg",
                "Chai": "https://i.imgur.com/wRIJ7AO.jpeg", 
                "Mocha": "https://i.imgur.com/Pdp3Q4O.jpeg", 
                "Cookies & Cream": "https://i.imgur.com/0e402nf.jpeg",
                "Crema Irlandesa": "https://i.imgur.com/fJocyJw.jpeg",
                "Matcha": "https://i.imgur.com/6QIRLrZ.jpeg",
                // Images for hot drinks (all point to the generic hot drinks image for now)
                "Chocolate Caliente": genericHotDrinksImage,
                "Taro Caliente": genericHotDrinksImage,
                "Mazap√°n Caliente": genericHotDrinksImage,
                "Chai Caliente": genericHotDrinksImage,
                "Mocha Caliente": genericHotDrinksImage,
                "Cookies & Cream Caliente": genericHotDrinksImage,
                "Crema Irlandesa Caliente": genericHotDrinksImage,
                "Matcha Caliente": genericHotDrinksImage,
                // Image for seasonal promotion
                "Frapp√© Fresas con Crema (Temporada)": "https://i.imgur.com/m2Fc29F.jpeg"
            };

            flavorItems.forEach(item => {
                // Keep the click for image display
                item.addEventListener('click', function(event) {
                    // Prevent button click from triggering image overlay if clicked directly on button
                    if (event.target.tagName === 'BUTTON') {
                        return; 
                    }
                    const flavorName = this.querySelector('.flavor-name').textContent;
                    // Use a fallback placeholder if the image URL is not found
                    const imageUrl = flavorImages[flavorName] || 'https://placehold.co/300x300/CCCCCC/FFF?text=Image+not+available'; 
                    if (flavorImage) { // Check if flavorImage element exists
                        flavorImage.src = imageUrl;
                        // Robust image error handling for flavorImage
                        flavorImage.onerror = function() { 
                            this.src = 'https://placehold.co/300x300/FF6347/FFFFFF?text=Error+Loading'; // Red placeholder
                            this.alt = 'Error loading image'; // Update alt text
                        };
                    }
                    if (flavorImageName) { // Check if flavorImageName element exists
                        flavorImageName.textContent = flavorName;
                    }
                    if (flavorImageOverlay) { // Check if flavorImageOverlay element exists
                        flavorImageOverlay.classList.add('show'); 
                    }
                });
            });

            if (flavorImageOverlay) { // Check if flavorImageOverlay element exists
                flavorImageOverlay.addEventListener('click', function() {
                    flavorImageOverlay.classList.remove('show'); 
                });
            }

            // Promotions Logic (Updated to use add-drink-to-cart-button)
            const fresasConCremaPromotion = document.getElementById('fresasConCremaPromotion');
            if (fresasConCremaPromotion) {
                // Keep image display on promotion item click (not the button)
                fresasConCremaPromotion.addEventListener('click', function(event) {
                    if (event.target.tagName === 'BUTTON') {
                        return;
                    }
                    // Specific image for the seasonal frapp√©
                    if (flavorImage) {
                        flavorImage.src = flavorImages["Frapp√© Fresas con Crema (Temporada)"] || 'https://placehold.co/300x300/CCCCCC/FFF?text=Image+not+available';
                        // Robust image error handling for flavorImage
                        flavorImage.onerror = function() { 
                            this.src = 'https://placehold.co/300x300/FF6347/FFFFFF?text=Error+Loading'; // Red placeholder
                            this.alt = 'Error loading image'; // Update alt text
                        };
                    }
                    if (flavorImageName) {
                        flavorImageName.textContent = "Frapp√© de Temporada: Fresas con Crema";
                    }
                    if (flavorImageOverlay) {
                        flavorImageOverlay.classList.add('show');
                    }
                });
            }

            // Shopping Cart & Topping Selection Logic
            let cart = []; // Stores selected items: { id, name, basePrice, selectedToppings: [{ name, price }] }
            let currentDrinkBeingCustomized = null; // Holds the drink object while toppings are being selected
            let lastClickedAddButton = null; // Reference to the button that was clicked

            const cartItemsList = document.getElementById('cartItemsList');
            const cartTotalElement = document.getElementById('cartTotal');
            const clearCartButton = document.getElementById('clearCartButton');
            const orderWhatsAppButton = document.getElementById('orderWhatsAppButton');
            // Select ALL buttons with this class, including new hot drink buttons
            const addDrinkToCartButtons = document.querySelectorAll('.add-drink-to-cart-button');

            // Topping Modal Elements
            const toppingSelectionOverlay = document.getElementById('toppingSelectionOverlay');
            const toppingDrinkNameElement = document.getElementById('toppingDrinkName');
            const toppingsModalGrid = document.getElementById('toppingsModalGrid');
            const confirmToppingsButton = document.getElementById('confirmToppingsButton');
            const noToppingsButton = document.getElementById('noToppingsButton');
            const cancelToppingsButton = document.getElementById('cancelToppingsButton');

            // Define available toppings (matching data from HTML, but easier to manage here)
            const availableToppings = [
                { name: "Perlas explosivas de frutos rojos", price: 10 },
                { name: "Perlas explosivas de manzana verde", price: 10 },
                { name: "Perlas explosivas de litchi", price: 10 },
                { name: "Jelly arcoiris", price: 10 }
            ];

            // Function to open the topping selection modal
            function openToppingSelectionModal(drinkName, drinkPrice, clickedButton) {
                currentDrinkBeingCustomized = {
                    id: generateUniqueId(), // Assign a temporary ID
                    name: drinkName,
                    basePrice: drinkPrice,
                    selectedToppings: []
                };
                lastClickedAddButton = clickedButton; // Store reference to the button

                if (toppingDrinkNameElement) { // Check if element exists
                    toppingDrinkNameElement.textContent = drinkName;
                }
                if (toppingsModalGrid) { // Check if element exists
                    toppingsModalGrid.innerHTML = ''; // Clear previous toppings

                    // Populate toppings in the modal
                    availableToppings.forEach(topping => {
                        const toppingItemDiv = document.createElement('div');
                        toppingItemDiv.className = 'topping-modal-item';
                        toppingItemDiv.dataset.name = topping.name;
                        toppingItemDiv.dataset.price = topping.price;

                        const isSelected = currentDrinkBeingCustomized.selectedToppings.some(t => t.name === topping.name);
                        if (isSelected) {
                            toppingItemDiv.classList.add('selected');
                        }

                        toppingItemDiv.innerHTML = `
                            <span class="topping-modal-name">${topping.name}</span>
                            <span class="topping-modal-price">+$${topping.price}</span>
                            <button class="add-topping-button ${isSelected ? 'remove' : ''}" 
                                    data-action="${isSelected ? 'remove' : 'add'}">
                                ${isSelected ? 'Quitar ‚ûñ' : 'A√±adir ‚ú®'}
                            </button>
                        `;
                        toppingsModalGrid.appendChild(toppingItemDiv);
                    });

                    // Attach event listeners for topping buttons in the modal
                    toppingsModalGrid.querySelectorAll('.add-topping-button').forEach(button => {
                        button.addEventListener('click', function() {
                            const toppingItemDiv = this.closest('.topping-modal-item');
                            const toppingName = toppingItemDiv.dataset.name;
                            const toppingPrice = parseFloat(toppingItemDiv.dataset.price);

                            const action = this.dataset.action;

                            if (action === 'add') {
                                currentDrinkBeingCustomized.selectedToppings.push({ name: toppingName, price: toppingPrice });
                                toppingItemDiv.classList.add('selected');
                                this.textContent = 'Quitar ‚ûñ';
                                this.dataset.action = 'remove';
                                this.classList.add('remove');
                            } else {
                                currentDrinkBeingCustomized.selectedToppings = currentDrinkBeingCustomized.selectedToppings.filter(t => t.name !== toppingName);
                                toppingItemDiv.classList.remove('selected');
                                this.textContent = 'A√±adir ‚ú®';
                                this.dataset.action = 'add';
                                this.classList.remove('remove');
                            }
                        });
                    });
                }

                if (toppingSelectionOverlay) { // Check if element exists
                    toppingSelectionOverlay.classList.add('show');
                }
            }

            // Function to add the customized drink to the main cart
            function addCustomizedDrinkToCart() {
                if (currentDrinkBeingCustomized) {
                    // Calculate total price for this specific drink instance
                    let itemTotalPrice = currentDrinkBeingCustomized.basePrice;
                    currentDrinkBeingCustomized.selectedToppings.forEach(t => {
                        itemTotalPrice += t.price;
                    });
                    currentDrinkBeingCustomized.itemTotalPrice = itemTotalPrice;

                    // Add to the main cart
                    cart.push({ ...currentDrinkBeingCustomized }); // Push a copy
                    currentDrinkBeingCustomized = null; // Clear the temporary drink
                    if (toppingSelectionOverlay) { // Check if element exists
                        toppingSelectionOverlay.classList.remove('show'); // Hide modal
                    }
                    updateCartDisplay();

                    // Visual feedback on the add button
                    if (lastClickedAddButton) {
                        const originalText = 'A√±adir üíñ';
                        const originalBackground = lastClickedAddButton.style.background || '';

                        lastClickedAddButton.textContent = '¬°A√±adido! ‚úÖ';
                        lastClickedAddButton.classList.add('added-feedback');
                        
                        setTimeout(() => {
                            lastClickedAddButton.textContent = originalText;
                            lastClickedAddButton.classList.remove('added-feedback');
                            lastClickedAddButton.style.background = originalBackground; 
                        }, 1000);
                        lastClickedAddButton = null; 
                    }
                }
            }

            // Event Listeners for "Add Drink to Cart" buttons
            addDrinkToCartButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemElement = this.closest('[data-name][data-price]');
                    if (itemElement) { // Ensure itemElement exists
                        const name = itemElement.dataset.name;
                        const price = parseFloat(itemElement.dataset.price);
                        openToppingSelectionModal(name, price, this); // Pass the clicked button
                    }
                });
            });

            // Event Listeners for Topping Modal Buttons
            if (confirmToppingsButton) { // Check if element exists
                confirmToppingsButton.addEventListener('click', addCustomizedDrinkToCart);
            }
            if (noToppingsButton) { // Check if element exists
                noToppingsButton.addEventListener('click', function() {
                    // If "No Toppings" is clicked, ensure selectedToppings is empty and add to cart
                    if (currentDrinkBeingCustomized) {
                        currentDrinkBeingCustomized.selectedToppings = [];
                        addCustomizedDrinkToCart();
                    }
                });
            }
            if (cancelToppingsButton) { // Check if element exists
                cancelToppingsButton.addEventListener('click', function() {
                    currentDrinkBeingCustomized = null; // Discard current selection
                    if (toppingSelectionOverlay) { // Check if element exists
                        toppingSelectionOverlay.classList.remove('show'); // Hide modal
                    }
                    if (lastClickedAddButton) { // Reset the button if canceled
                        lastClickedAddButton.textContent = 'A√±adir üíñ';
                        lastClickedAddButton.classList.remove('added-feedback');
                        lastClickedAddButton.style.background = ''; // Revert to original background (from CSS)
                        lastClickedAddButton = null;
                    }
                });
            }

            // Function to clear the entire cart
            function clearCart() {
                console.log("clearCart() function called.");
                console.log("Cart before clearing:", JSON.stringify(cart));
                cart = []; // Clears the cart array
                console.log("Cart after clearing:", JSON.stringify(cart));
                updateCartDisplay(); // Updates the UI
                console.log("Cart display updated after clearing.");

                // Reset all add buttons
                addDrinkToCartButtons.forEach(button => {
                    button.textContent = 'A√±adir üíñ';
                    button.classList.remove('added-feedback');
                    button.style.background = ''; // Revert to original background defined in CSS
                });
                lastClickedAddButton = null; // Ensure the reference is also cleared
            }


            // Function to update the cart display in the HTML
            function updateCartDisplay() {
                if (!cartItemsList || !cartTotalElement) { // Ensure elements exist
                    console.error("Cart display elements not found.");
                    return;
                }
                cartItemsList.innerHTML = ''; // Clear current display
                let total = 0;

                // Group identical items for display
                const groupedCart = {};
                cart.forEach(item => {
                    const toppingNames = item.selectedToppings.map(t => t.name).sort().join(', ');
                    const key = `${item.name}|${toppingNames}`;

                    if (groupedCart[key]) {
                        groupedCart[key].quantity++;
                    } else {
                        groupedCart[key] = {
                            // Only copy necessary display properties for the grouped item
                            name: item.name,
                            selectedToppings: item.selectedToppings,
                            quantity: 1,
                            // Recalculate total price for this specific instance (base + toppings)
                            totalItemPrice: item.basePrice + item.selectedToppings.reduce((sum, t) => sum + t.price, 0),
                            // Store the original ID to allow removing one instance at a time
                            originalIds: [item.id]
                        };
                    }
                });

                const sortedGroupedItems = Object.values(groupedCart).sort((a, b) => a.name.localeCompare(b.name));

                if (sortedGroupedItems.length === 0) {
                    cartItemsList.innerHTML = '<li style="text-align: center; color: #6b7280;">¬°Tu carrito est√° vac√≠o, a√±ade algo delicioso! üíñ</li>';
                } else {
                    sortedGroupedItems.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'cart-item';

                        let toppingsText = '';
                        if (item.selectedToppings && item.selectedToppings.length > 0) {
                            toppingsText = `(+ ${item.selectedToppings.map(t => t.name).join(', ')})`;
                        }

                        li.innerHTML = `
                            <div class="item-main-info">
                                <span class="item-quantity">${item.quantity}x</span> 
                                <span class="item-name">${item.name}</span>
                            </div>
                            <div class="item-details">
                                <span class="item-toppings">${toppingsText}</span>
                                <span class="item-price">$${item.totalItemPrice * item.quantity}</span>
                                <button class="remove-item-button" data-key="${item.name}|${item.selectedToppings.map(t => t.name).sort().join(', ')}">‚ûñ</button>
                            </div>
                        `;
                        // The data-key refers to the grouped key, which will allow us to find the original item to remove
                        cartItemsList.appendChild(li);
                        total += item.totalItemPrice * item.quantity;
                    });
                }

                cartTotalElement.textContent = `Total: $${total}`;

                // Re-attach event listeners for dynamically created remove buttons
                cartItemsList.querySelectorAll('.remove-item-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemKeyToRemove = event.target.dataset.key; // Get the unique key for the grouped item
                        
                        // Find the corresponding item in the original cart array and remove ONE instance
                        // We need to match by name and toppings to remove one instance of the displayed grouped item
                        const [itemName, toppingNamesString] = itemKeyToRemove.split('|');
                        const toppingsToMatch = toppingNamesString.split(', ').filter(Boolean); // Handle empty topping string

                        const indexToRemove = cart.findIndex(cartItem => 
                            cartItem.name === itemName &&
                            cartItem.selectedToppings.length === toppingsToMatch.length &&
                            // Check if all selected toppings match
                            cartItem.selectedToppings.every(t => toppingsToMatch.includes(t.name)) &&
                            // And importantly, that all toppings to match are present in the item's toppings
                            toppingsToMatch.every(tName => cartItem.selectedToppings.some(st => st.name === tName))
                        );

                        if (indexToRemove > -1) {
                            cart.splice(indexToRemove, 1);
                        }
                        updateCartDisplay();
                    });
                });

                // Scroll the cart to the bottom
                cartItemsList.scrollTop = cartItemsList.scrollHeight;
            }

            // Function to generate the WhatsApp message
            function generateWhatsAppMessage() {
                console.log("Attempting to generate WhatsApp message...");

                if (cart.length === 0) {
                    if (orderWhatsAppButton) { // Check if element exists
                        orderWhatsAppButton.textContent = "¬°Carrito Vac√≠o! A√±ade algo üö´";
                        orderWhatsAppButton.style.background = "#FF6347";
                        setTimeout(() => {
                            orderWhatsAppButton.textContent = "Pedir por WhatsApp üì±";
                            orderWhatsAppButton.style.background = "linear-gradient(45deg, #25D366, #128C7E)";
                        }, 2000);
                    }
                    console.warn("Cart is empty. Cannot generate WhatsApp message.");
                    return;
                }

                let message = "¬°Hola! Me gustar√≠a hacer el siguiente pedido de Capibobba:\n\n";
                let finalTotal = 0;

                // Group items for the WhatsApp message for clarity
                const groupedForWhatsApp = {};
                cart.forEach(item => {
                    const toppingNames = item.selectedToppings.map(t => t.name).sort().join(', ');
                    const key = `${item.name}|${toppingNames}`;

                    if (groupedForWhatsApp[key]) {
                        groupedForWhatsApp[key].quantity++;
                        groupedForWhatsApp[key].totalPricePerItem += item.basePrice + item.selectedToppings.reduce((sum, t) => sum + t.price, 0);
                    } else {
                        groupedForWhatsApp[key] = {
                            name: item.name,
                            basePrice: item.basePrice,
                            selectedToppings: item.selectedToppings,
                            quantity: 1,
                            totalPricePerItem: item.basePrice + item.selectedToppings.reduce((sum, t) => sum + t.price, 0)
                        };
                    }
                });

                let itemNumber = 1;
                Object.values(groupedForWhatsApp).forEach(item => {
                    let toppingsDetail = '';
                    if (item.selectedToppings && item.selectedToppings.length > 0) {
                        toppingsDetail = ` con ${item.selectedToppings.map(t => t.name).join(', ')}`;
                    }
                    message += `${itemNumber}. ${item.quantity}x ${item.name}${toppingsDetail} ($${item.totalPricePerItem * item.quantity})\n`;
                    finalTotal += item.totalPricePerItem * item.quantity;
                    itemNumber++;
                });

                message += `\nTotal del pedido: $${finalTotal}`;
                message += `\n\n¬°Estoy emocionado/a por mis bebidas kawaii! üíñ`;
                // Removed the "If some milk-based drink is 'hot', you can specify it here" instruction
                // as now hot drinks have their own explicit names.

                const whatsappNumber = "5217712794633";
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

                console.log("WhatsApp URL to open:", whatsappUrl);

                // Attempt to open the window
                const newWindow = window.open(whatsappUrl, '_blank');

                // Check if the window was blocked by a pop-up blocker
                if (newWindow === null || typeof newWindow === 'undefined' || newWindow.closed) {
                    console.error("Popup blocked or window could not be opened.");
                    // Provide visual feedback to the user
                    if (orderWhatsAppButton) { // Check if element exists
                        orderWhatsAppButton.textContent = "Pop-up bloqueado. ¬°Revisa tu navegador! ‚ö†Ô∏è";
                        orderWhatsAppButton.style.background = "#FF6347"; // Red color for error
                        setTimeout(() => {
                            orderWhatsAppButton.textContent = "Pedir por WhatsApp üì±";
                            orderWhatsAppButton.style.background = "linear-gradient(45deg, #25D366, #128C7E)"; // Revert to green
                        }, 4000); // Give user more time to see the message
                    }
                } else {
                    console.log("WhatsApp window opened successfully.");
                }
            }

            // Corrected Event Listener Attachments
            // Check if clearCartButton is found, and then attach listener
            if (clearCartButton) {
                clearCartButton.addEventListener('click', function() {
                    console.log("Clear Cart button clicked.");
                    clearCart();
                });
            } else {
                console.error("Error: clearCartButton not found!");
            }

            // Check if orderWhatsAppButton is found, and then attach listener
            if (orderWhatsAppButton) {
                orderWhatsAppButton.addEventListener('click', generateWhatsAppMessage);
            } else {
                console.error("Error: orderWhatsAppButton not found!");
            }
            // End Corrected Event Listener Attachments

            // Initial display update when page loads
            updateCartDisplay();
        });
    </script>
</body>
</html>

